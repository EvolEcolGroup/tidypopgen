<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Interpolating Heterozygosity • tidypopgen</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interpolating Heterozygosity">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidypopgen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tidypopgen.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a01_overview.html">The grammar of population genetics</a></li>
    <li><a class="dropdown-item" href="../articles/a02_qc.html">Quality Control</a></li>
    <li><a class="dropdown-item" href="../articles/a03_example_clustering_and_dapc.html">Population genetic analysis with tidypopgen</a></li>
    <li><a class="dropdown-item" href="../articles/a99_plink_cheatsheet.html">PLINK cheatsheet</a></li>
    <li><a class="dropdown-item" href="../articles/aDNA_pseudohaploids.html">Working with aDNA pseuodhaploid samples</a></li>
    <li><a class="dropdown-item" href="../articles/benchmark_hgdp.html">Benchmark on the HGDP</a></li>
    <li><a class="dropdown-item" href="../articles/interpolating_hgdp.html">Interpolating Heterozygosity</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EvolEcolGroup/tidypopgen/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Interpolating Heterozygosity</h1>
            
            <h4 data-toc-skip class="date">2025-10-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/EvolEcolGroup/tidypopgen/blob/dev/vignettes/articles/interpolating_hgdp.Rmd" class="external-link"><code>vignettes/articles/interpolating_hgdp.Rmd</code></a></small>
      <div class="d-none name"><code>interpolating_hgdp.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we will demonstrate how to interpolate measures of
genetic diversity across geographic space using the tidypopgen
integration with the <code>sf</code> package.</p>
<p>To do so, we will use the Human Genome Diversity Project (HGDP)
dataset.</p>
<p>The data files can be downloaded using the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">download_url</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"https://zenodo.org/records/17375732/files/hgdp650_id_pop_coords.txt"</span></span>
<span><span class="va">download_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"hgdp650_id_pop.txt"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">download_url</span>, <span class="va">download_path</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="va">download_url</span> <span class="op">&lt;-</span> <span class="st">"https://zenodo.org/records/17375732/files/hgdp650.qc.hg19.bed"</span></span>
<span><span class="va">download_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"hgdp650.qc.hg19.bed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">download_url</span>, <span class="va">download_path</span>, method <span class="op">=</span> <span class="st">"wget"</span><span class="op">)</span></span>
<span><span class="va">download_url</span> <span class="op">&lt;-</span> <span class="st">"https://zenodo.org/records/17375732/files/hgdp650.qc.hg19.bim"</span></span>
<span><span class="va">download_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"hgdp650.qc.hg19.bim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">download_url</span>, <span class="va">download_path</span>, method <span class="op">=</span> <span class="st">"wget"</span><span class="op">)</span></span>
<span><span class="va">download_url</span> <span class="op">&lt;-</span> <span class="st">"https://zenodo.org/records/17375732/files/hgdp650.qc.hg19.fam"</span></span>
<span><span class="va">download_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"hgdp650.qc.hg19.fam"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">download_url</span>, <span class="va">download_path</span>, method <span class="op">=</span> <span class="st">"wget"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="create-gen_tibble-object">Create gen_tibble object<a class="anchor" aria-label="anchor" href="#create-gen_tibble-object"></a>
</h2>
<p>Our first step is to load the HGDP data into a
<code>gen_tibble</code> object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bed_path</span> <span class="op">&lt;-</span> <span class="st">"./data/hgdp/hgdp650.qc.hg19.bed"</span></span>
<span></span>
<span><span class="va">hgdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_tibble.html">gen_tibble</a></span><span class="op">(</span><span class="va">bed_path</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  backingfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"test_"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And add its associated metadata</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_info</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span><span class="st">"./data/hgdp/hgdp650_id_pop_coords.txt"</span>, col_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1043 Columns: 6</span></span>
<span><span class="co">#&gt; ── Column specification ───────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: "\t"</span></span>
<span><span class="co">#&gt; chr (4): id, population, geographic_origin, region</span></span>
<span><span class="co">#&gt; dbl (2): latitude, longitude</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span></span>
<span><span class="va">hgdp</span> <span class="op">&lt;-</span> <span class="va">hgdp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">meta_info</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">hgdp</span><span class="op">$</span><span class="va">id</span>, <span class="va">meta_info</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  geographic_origin <span class="op">=</span> <span class="va">meta_info</span><span class="op">$</span><span class="va">geographic_origin</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">hgdp</span><span class="op">$</span><span class="va">id</span>, <span class="va">meta_info</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  region <span class="op">=</span> <span class="va">meta_info</span><span class="op">$</span><span class="va">region</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">hgdp</span><span class="op">$</span><span class="va">id</span>, <span class="va">meta_info</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  latitude <span class="op">=</span> <span class="va">meta_info</span><span class="op">$</span><span class="va">latitude</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">hgdp</span><span class="op">$</span><span class="va">id</span>, <span class="va">meta_info</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  longitude <span class="op">=</span> <span class="va">meta_info</span><span class="op">$</span><span class="va">longitude</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">hgdp</span><span class="op">$</span><span class="va">id</span>, <span class="va">meta_info</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s confirm that we have all the expected information:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hgdp</span></span>
<span><span class="co">#&gt; # A gen_tibble: 643733 loci</span></span>
<span><span class="co">#&gt; # A tibble:     1,043 × 8</span></span>
<span><span class="co">#&gt;    id        phenotype  genotypes population geographic_origin            region latitude longitude</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;     &lt;fct&gt;     &lt;vctr_SNP&gt; &lt;chr&gt;      &lt;chr&gt;                        &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 HGDP00448 control    [2,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt;  2 HGDP00479 control    [1,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt;  3 HGDP00985 control    [0,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt;  4 HGDP01094 control    [1,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt;  5 HGDP00982 control    [2,0,...] Mbuti_HG   Democratic_Republic_of_Congo Africa        1        29</span></span>
<span><span class="co">#&gt;  6 HGDP00911 control    [1,0,...] Mandenka   Senegal                      Africa       12       -12</span></span>
<span><span class="co">#&gt;  7 HGDP01202 control    [2,0,...] Mandenka   Senegal                      Africa       12       -12</span></span>
<span><span class="co">#&gt;  8 HGDP00927 control    [2,0,...] Yoruba     Nigeria                      Africa        8         5</span></span>
<span><span class="co">#&gt;  9 HGDP00461 control    [2,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt; 10 HGDP00451 control    [2,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt; # ℹ 1,033 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gen_tibble-with-sf">Gen_tibble with sf<a class="anchor" aria-label="anchor" href="#gen_tibble-with-sf"></a>
</h2>
<p>Now that we have latitudes and longitudes in our tibble; we can
transform them into an <code>sf</code> geometry with the function
<code><a href="../reference/gt_add_sf.html">gt_add_sf()</a></code>. Once we have done that, our
<code>gen_tibble</code> will act as an <code>sf</code> object, which can
be plotted with <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hgdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_add_sf.html">gt_add_sf</a></span><span class="op">(</span><span class="va">hgdp</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hgdp</span></span>
<span><span class="co">#&gt; Simple feature collection with 1043 features and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -108 ymin: -25.83333 xmax: 155 ymax: 63</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A gen_tibble: 643733 loci</span></span>
<span><span class="co">#&gt; # A tibble:     1,043 × 9</span></span>
<span><span class="co">#&gt;    id        phenotype  genotypes population geographic_origin            region latitude longitude</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;     &lt;fct&gt;     &lt;vctr_SNP&gt; &lt;chr&gt;      &lt;chr&gt;                        &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 HGDP00448 control    [2,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt;  2 HGDP00479 control    [1,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt;  3 HGDP00985 control    [0,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt;  4 HGDP01094 control    [1,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt;  5 HGDP00982 control    [2,0,...] Mbuti_HG   Democratic_Republic_of_Congo Africa        1        29</span></span>
<span><span class="co">#&gt;  6 HGDP00911 control    [1,0,...] Mandenka   Senegal                      Africa       12       -12</span></span>
<span><span class="co">#&gt;  7 HGDP01202 control    [2,0,...] Mandenka   Senegal                      Africa       12       -12</span></span>
<span><span class="co">#&gt;  8 HGDP00927 control    [2,0,...] Yoruba     Nigeria                      Africa        8         5</span></span>
<span><span class="co">#&gt;  9 HGDP00461 control    [2,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt; 10 HGDP00451 control    [2,0,...] Biaka_HG   Central_African_Republic     Africa        4        17</span></span>
<span><span class="co">#&gt; # ℹ 1,033 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: geometry &lt;POINT [°]&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="interpolating-heterozygosity">Interpolating heterozygosity<a class="anchor" aria-label="anchor" href="#interpolating-heterozygosity"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jakubnowosad.com/spData/" class="external-link">spData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></code></pre></div>
<p>Calculating heterozygosity is simple in <code>tidypopgen</code>.
First, lets run some basic filtering to remove SNPs in linkage:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hgdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gt_impute_simple.html">gt_impute_simple</a></span><span class="op">(</span><span class="va">hgdp</span><span class="op">)</span></span>
<span><span class="va">to_keep</span> <span class="op">&lt;-</span> <span class="va">hgdp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/loci_ld_clump.html">loci_ld_clump</a></span><span class="op">(</span></span>
<span>  thr_r2 <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  return_id <span class="op">=</span> <span class="cn">TRUE</span>, use_positions <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hgdp</span> <span class="op">&lt;-</span> <span class="va">hgdp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/select_loci.html">select_loci</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">to_keep</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can store heterozygosity for each individual in our gen_tibble
object by creating a column with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> and using the
function <code><a href="../reference/indiv_het_obs.html">indiv_het_obs()</a></code> to calculate observed
heterozygosity for each individual. Then we can create a new column with
the mean heterozygosity for each population</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hgdp</span> <span class="op">&lt;-</span> <span class="va">hgdp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>heterozygosity <span class="op">=</span> <span class="fu"><a href="../reference/indiv_het_obs.html">indiv_het_obs</a></span><span class="op">(</span><span class="va">genotypes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mean_het</span> <span class="op">&lt;-</span> <span class="va">hgdp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_het <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">heterozygosity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hgdp</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">hgdp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mean_het <span class="op">=</span> <span class="va">mean_het</span><span class="op">$</span><span class="va">mean_het</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span></span>
<span>    <span class="va">hgdp</span><span class="op">$</span><span class="va">population</span>,</span>
<span>    <span class="va">mean_het</span><span class="op">$</span><span class="va">population</span></span>
<span>  <span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>We can then begin by creating a global map using
<code>rnaturalearth</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"medium"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sovereignt</span> <span class="op">!=</span> <span class="st">"Antarctica"</span><span class="op">)</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="va">map</span>, <span class="st">"POLYGON"</span><span class="op">)</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_wrap_dateline</a></span><span class="op">(</span><span class="va">map</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WRAPDATELINE=YES"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can check the distribution of our samples across the map using our
<code>gen_tibble</code> with <code>sf</code> geometry:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hgdp</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">map</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/interpolating_hgdp/hgdp_map-1.png" alt="plot of chunk hgdp_map"><div class="figcaption">plot of chunk hgdp_map</div>
</div>
<p>Our map shows the distribution of the HGDP data, but we can see that
there are gaps in the sampling. We know that heterozygosity decreases
with distance from Africa, so we can use spatial interpolation to
estimate heterozygosity in unsampled areas.</p>
<p>To begin, we will create a grid of points covering the map.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">map</span>, nrows <span class="op">=</span> <span class="fl">200</span>, ncols <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">grid</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>By converting this grid to an <code>sf</code> object, we can then use
<code><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter()</a></code> to keep only the points that fall within the
landmasses.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">coop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">coop</span>, <span class="va">map</span><span class="op">)</span></span></code></pre></div>
<p>And we can quickly visualise this grid using the <code>qtm</code>
autoplotting function from the <code>tmap</code> package:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">qtm</span><span class="op">(</span><span class="va">coop</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figure/interpolating_hgdp/global_grid_map-1.png" alt="plot of chunk global_grid_map"><div class="figcaption">plot of chunk global_grid_map</div>
</div>
<p>Now we can use the <code>gstat</code> package to perform spatial
interpolation of heterozygosity.</p>
<p><code>gstat</code> implements several methods for spatial
interpolation, including inverse distance weighting (IDW) and kriging.
Here, we will use IDW to interpolate heterozygosity across our grid of
points.</p>
<p>We remove the genotypes from our <code>gen_tibble</code>, as
<code>gstat</code> does not accept a <code>gen_tibble</code> object, and
then run the interpolation:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hgdp_sf_obj</span> <span class="op">&lt;-</span> <span class="va">hgdp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="st">"genotypes"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/" class="external-link">gstat</a></span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">mean_het</span> <span class="op">~</span> <span class="fl">1</span>, locations <span class="op">=</span> <span class="va">hgdp_sf_obj</span>,</span>
<span>  nmax <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hgdp_sf_obj</span><span class="op">)</span>,</span>
<span>  set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>idp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">coop</span><span class="op">)</span></span>
<span><span class="co">#&gt; [inverse distance weighted interpolation]</span></span>
<span><span class="va">resp</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">resp</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>We can visualise the interpolated values using <code>tmap</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span><span class="va">resp</span>, <span class="va">grid</span>, field <span class="op">=</span> <span class="st">"var1.pred"</span>, fun <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">pred</span><span class="op">)</span> <span class="op">+</span> <span class="fu">tm_raster</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, palette <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── tmap v3 code detected ──────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; [v3-&gt;v4] `tm_tm_raster()`: migrate the argument(s) related to the scale of the visual variable `col`</span></span>
<span><span class="co">#&gt; namely 'palette' (rename to 'values') to col.scale = tm_scale(&lt;HERE&gt;).</span></span>
<span><span class="co">#&gt; [v3-&gt;v4] `tm_raster()`: use `col_alpha` instead of `alpha`.</span></span></code></pre></div>
<div class="float">
<img src="figure/interpolating_hgdp/interpolated_map-1.png" alt="plot of chunk interpolated_map"><div class="figcaption">plot of chunk interpolated_map</div>
</div>
<p>Or, for a more publication-ready figure, we can use
<code>ggplot2</code> and the <code>tidyterra</code> package:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hgdp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">mean_het</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">var1.pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Interpolated Heterozygosity"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    na.value <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Observed"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `geom_spatraster()`:</span></span>
<span><span class="co">#&gt; ! Problem while computing aesthetics.</span></span>
<span><span class="co">#&gt; ℹ Error occurred in the 2nd layer.</span></span>
<span><span class="co">#&gt; Caused by error:</span></span>
<span><span class="co">#&gt; ! object 'var1.pred' not found</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Evie Carter, Eirlys Tysall, Andrea Manica.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
