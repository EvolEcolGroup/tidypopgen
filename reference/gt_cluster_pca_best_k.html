<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Find the best number of clusters based on principal components — gt_cluster_pca_best_k • tidypopgen</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find the best number of clusters based on principal components — gt_cluster_pca_best_k"><meta name="description" content="This function selects the best k value based on a chosen metric and
criterion. It is equivalent to plotting the metric against the k values,
and selecting the k that fulfills a given criterion (see details for an
explanation of each criterion). This function simply adds an element 'best_k'
to the gt_cluster_pca returned by gt_cluster_pca(). The choice can be
over-ridden simply by assigning a different value to that element (e.g. for
an object x and a desired k of 8, simply use x$best_k &amp;lt;- 8)"><meta property="og:description" content="This function selects the best k value based on a chosen metric and
criterion. It is equivalent to plotting the metric against the k values,
and selecting the k that fulfills a given criterion (see details for an
explanation of each criterion). This function simply adds an element 'best_k'
to the gt_cluster_pca returned by gt_cluster_pca(). The choice can be
over-ridden simply by assigning a different value to that element (e.g. for
an object x and a desired k of 8, simply use x$best_k &amp;lt;- 8)"><meta property="og:image" content="https://evolecolgroup.github.io/tidypopgen/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidypopgen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/tidypopgen.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/a01_overview.html">The grammar of population genetics</a></li>
    <li><a class="dropdown-item" href="../articles/a02_qc.html">Quality Control</a></li>
    <li><a class="dropdown-item" href="../articles/a03_example_clustering_and_dapc.html">Population genetic analysis with tidypopgen</a></li>
    <li><a class="dropdown-item" href="../articles/a99_plink_cheatsheet.html">PLINK cheatsheet</a></li>
    <li><a class="dropdown-item" href="../articles/aDNA_pseudohaploids.html">Working with aDNA pseuodhaploid samples</a></li>
    <li><a class="dropdown-item" href="../articles/benchmark_hgdp.html">Benchmark on the HGDP</a></li>
    <li><a class="dropdown-item" href="../articles/interpolating_hgdp.html">Interpolating Heterozygosity</a></li>
    <li><a class="dropdown-item" href="../articles/interpolating.html">Interpolating genetic data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EvolEcolGroup/tidypopgen/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Find the best number of clusters based on principal components</h1>
      <small class="dont-index">Source: <a href="https://github.com/EvolEcolGroup/tidypopgen/blob/main/R/gt_cluster_pca_best_k.R" class="external-link"><code>R/gt_cluster_pca_best_k.R</code></a></small>
      <div class="d-none name"><code>gt_cluster_pca_best_k.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function selects the best k value based on a chosen metric and
criterion. It is equivalent to plotting the metric against the <em>k</em> values,
and selecting the <em>k</em> that fulfills a given criterion (see details for an
explanation of each criterion). This function simply adds an element 'best_k'
to the <code>gt_cluster_pca</code> returned by <code><a href="gt_cluster_pca.html">gt_cluster_pca()</a></code>. The choice can be
over-ridden simply by assigning a different value to that element (e.g. for
an object x and a desired <em>k</em> of 8, simply use <code>x$best_k &lt;- 8</code>)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gt_cluster_pca_best_k</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BIC"</span>, <span class="st">"AIC"</span>, <span class="st">"WSS"</span><span class="op">)</span>,</span>
<span>  criterion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diffNgroup"</span>, <span class="st">"min"</span>, <span class="st">"goesup"</span>, <span class="st">"smoothNgoesup"</span>, <span class="st">"goodfit"</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a <code>gt_cluster_pca</code> object obtained with <code><a href="gt_cluster_pca.html">gt_cluster_pca()</a></code></p></dd>


<dt id="arg-stat">stat<a class="anchor" aria-label="anchor" href="#arg-stat"></a></dt>
<dd><p>a statistics, one of "BIC", "AIC" or "WSS"</p></dd>


<dt id="arg-criterion">criterion<a class="anchor" aria-label="anchor" href="#arg-criterion"></a></dt>
<dd><p>one of "diffNgroup", "min", "goesup", "smoothNgoesup",
"goodfit", see details for a discussion of each approach.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>boolean on whether to silence outputting information to the
screen (defaults to FALSE)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a 'gt_cluster_pca' object with an added element 'best_k'</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The analysis of data simulated under various population genetics models (see
reference) suggested an ad-hoc rule for the selection of the optimal number
of clusters. First important result is that BIC seems more efficient than AIC
and WSS to select the appropriate number of clusters (see example). The rule
of thumb consists in increasing K until it no longer leads to an appreciable
improvement of fit (i.e., to a decrease of BIC). In the most simple models
(island models), BIC decreases until it reaches the optimal K, and then
increases. In these cases, the best rule amounts to choosing the lowest K. In
other models such as stepping stones, the decrease of BIC often continues
after the optimal K, but is much less steep, so a change in slope can be
taken as an indication of where the best <em>k</em> lies.</p>
<p>This function provides a programmatic way to select <em>k</em>. Note that it is
highly recommended to look at the graph of BIC versus the numbers of
clusters, to understand and validate the programmatic selection. The criteria
available in this function are:</p><ul><li><p>"diffNgroup": differences between successive values of the summary
statistics (by default, BIC) are split into two groups using a Ward's
clustering method (see ?hclust), to differentiate sharp decrease from mild
decreases or increases. The retained K is the one before the first group
switch. This criterion appears to work well for island/hierarchical models,
and decently for isolation by distance models, albeit with some instability.
It can be confounded by an initial, very sharp decrease of the test
statistics. IF UNSURE ABOUT THE CRITERION TO USE, USE THIS ONE.</p></li>
<li><p>"min": the model with the minimum summary statistics (as specified by
stat argument, BIC by default) is retained. Is likely to work for simple
island model, using BIC. It is likely to fail in models relating to stepping
stones, where the BIC always decreases (albeit by a small amount) as K
increases. In general, this approach tends to over-estimate the number of
clusters.</p></li>
<li><p>"goesup": the selected model is the K after which increasing the number
of clusters leads to increasing the summary statistics. Suffers from
inaccuracy, since i) a steep decrease might follow a small 'bump' of increase
of the statistics, and ii) increase might never happen, or happen after
negligible decreases. Is likely to work only for clear-cut island models.</p></li>
<li><p>"smoothNgoesup": a variant of "goesup", in which the summary statistics
is first smoothed using a lowess approach. Is meant to be more accurate than
"goesup" as it is less prone to stopping to small 'bumps' in the decrease of
the statistics.</p></li>
<li><p>"goodfit": another criterion seeking a good fit with a minimum number
of clusters. This approach does not rely on differences between successive
statistics, but on absolute fit. It selects the model with the smallest K so
that the overall fit is above a given threshold.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Jombart T, Devillard S and Balloux F (2010) Discriminant analysis
of principal components: a new method for the analysis of genetically
structured populations. BMC Genetics 11:94. doi:10.1186/1471-2156-11-94</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a gen_tibble of lobster genotypes</span></span></span>
<span class="r-in"><span><span class="va">bed_file</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"lobster"</span>, <span class="st">"lobster.bed"</span>, package <span class="op">=</span> <span class="st">"tidypopgen"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lobsters</span> <span class="op">&lt;-</span> <span class="fu"><a href="gen_tibble.html">gen_tibble</a></span><span class="op">(</span><span class="va">bed_file</span>,</span></span>
<span class="r-in"><span>  backingfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"lobsters"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remove monomorphic loci and impute</span></span></span>
<span class="r-in"><span><span class="va">lobsters</span> <span class="op">&lt;-</span> <span class="va">lobsters</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="select_loci_if.html">select_loci_if</a></span><span class="op">(</span><span class="fu"><a href="loci_alt_freq.html">loci_maf</a></span><span class="op">(</span><span class="va">genotypes</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lobsters</span> <span class="op">&lt;-</span> <span class="fu"><a href="gt_impute_simple.html">gt_impute_simple</a></span><span class="op">(</span><span class="va">lobsters</span>, method <span class="op">=</span> <span class="st">"mode"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create PCA object</span></span></span>
<span class="r-in"><span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="gt_pca_partialSVD.html">gt_pca_partialSVD</a></span><span class="op">(</span><span class="va">lobsters</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run clustering on the first 10 PCs</span></span></span>
<span class="r-in"><span><span class="va">cluster_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="gt_cluster_pca.html">gt_cluster_pca</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">pca</span>,</span></span>
<span class="r-in"><span>  n_pca <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  k_clusters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"kmeans"</span>,</span></span>
<span class="r-in"><span>  n_iter <span class="op">=</span> <span class="fl">1e5</span>,</span></span>
<span class="r-in"><span>  n_start <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Find best K through minimum BIC</span></span></span>
<span class="r-in"><span><span class="va">cluster_pca</span> <span class="op">&lt;-</span> <span class="fu">gt_cluster_pca_best_k</span><span class="op">(</span><span class="va">cluster_pca</span>,</span></span>
<span class="r-in"><span>  stat <span class="op">=</span> <span class="st">"BIC"</span>,</span></span>
<span class="r-in"><span>  criterion <span class="op">=</span> <span class="st">"min"</span>,</span></span>
<span class="r-in"><span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using BIC with criterion min: 5 clusters</span>
<span class="r-in"><span><span class="co"># Best K is stored in the object</span></span></span>
<span class="r-in"><span><span class="va">cluster_pca</span><span class="op">$</span><span class="va">best_k</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Evie Carter, Eirlys Tysall, Andrea Manica.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

